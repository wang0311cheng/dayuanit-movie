<html>
<head>

    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">

    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <!-- import JavaScript -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <style>
        .el-row {
            margin-bottom: 20px;
        &:last-child {
             margin-bottom: 0;
         }
        }
        .el-col {
            border-radius: 4px;
        }
        .bg-purple-dark {
            background: #99a9bf;
        }
        .bg-purple {
            background: #d3dce6;
        }
        .bg-purple-light {
            background: #e5e9f2;
        }
        .grid-content {
            border-radius: 4px;
            min-height: 36px;
        }
        .row-bg {
            padding: 10px 0;
            background-color: #f9fafc;
        }
    </style>
</head>

<body>

<div id="app">
    <el-row>
        <el-col :span="18"><div class="grid-content">
            <div style="margin-left: 100px;">
                <div style="text-align: center;width:100%; height: 50px; background: url(data:image/png;base64,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) no-repeat;">
                </div>
                <div style="margin-left: 250px; margin-bottom: 100px">
                    银幕中央
                </div>
                <div style="height: 600px; width: 600px">
                    <el-row>
                        <el-col :span="3" v-for="seat in seats">
                            <div class="grid-content">
                            <img style="width: 30px;height: 30px"
                                 :src="seat.imgUrl"
                                 @click="choseSeatHandler(seat.id)">
                            </div>
                        </el-col>
                    </el-row>
                </div>
            </div>
        </div>
        </el-col>
        <el-col :span="6">
            <div class="grid-content">
                <el-row>
                    <el-col :span="14">
                        <div class="grid-content">
                            <img :src="'/picture/' + filmInfo.filmPic">
                        </div>
                    </el-col>
                    <el-col :span="10">
                        <div class="grid-content">
                            <el-row>
                                <el-col :span="24"><div class="grid-content">{{filmInfo.filmName}}</div></el-col>
                            </el-row>
                            <el-row>
                                <el-col :span="24"><div class="grid-content">{{filmInfo.filmType}}</div></el-col>
                            </el-row>
                            <el-row>
                                <el-col :span="24"><div class="grid-content">{{filmInfo.filmTime}}</div></el-col>
                            </el-row>
                        </div>
                    </el-col>
                </el-row>
            </div>
            <el-row>
                <el-col :span="4"><div class="grid-content">影院：</div></el-col>
                <el-col :span="20"><div class="grid-content">{{cinemaInfo.cinemaName}}</div></el-col>
            </el-row>

            <el-row>
                <el-col :span="4"><div class="grid-content">影厅：</div></el-col>
                <el-col :span="20"><div class="grid-content">{{sceneInfo.hall}}</div></el-col>
            </el-row>

            <el-row>
                <el-col :span="4"><div class="grid-content">版本：</div></el-col>
                <el-col :span="20"><div class="grid-content">{{sceneInfo.language}}</div></el-col>
            </el-row>

            <el-row>
                <el-col :span="4"><div class="grid-content">场次：</div></el-col>
                <el-col :span="20"><div class="grid-content">{{sceneInfo.showTime}}</div></el-col>
            </el-row>

            <el-row>
                <el-col :span="4"><div class="grid-content">票价：</div></el-col>
                <el-col :span="20"><div class="grid-content">￥{{sceneInfo.price}}/张</div></el-col>
            </el-row>
            <el-divider></el-divider>
            <el-row>
                <el-col :span="4">
                    <div class="grid-content">座位</div>
                </el-col>
                <el-col :span="20">
                    <div class="grid-content">
                        <el-tag
                                v-for="seatId in alreadyChoseSeatIds"
                                closable
                                @close="choseSeatHandler(seatId)">
                            {{seatId.split('-')[0] + '排' + seatId.split('-')[1] + '座'}}
                        </el-tag>
                    </div>
                </el-col>
            </el-row>

            <el-row>
                <el-col :span="4"><div class="grid-content">总价：</div></el-col>
                <el-col :span="20"><div class="grid-content">￥{{(sceneInfo.price * alreadyChoseSeatIds.length).toFixed(2)}}</div></el-col>
            </el-row>

            <el-row>
                <el-col :span="24">
                    <div class="grid-content">
                        <el-button type="danger" round @click="confimChose">
                            确认选座
                        </el-button>
                    </div>
                </el-col>
            </el-row>
        </el-col>
    </el-row>

</div>

</body>

<script>
    new Vue({
        el : '#app',
        data : {
            filmInfo : [],
            cinemaInfo : "",
            sceneInfo : [],
            filmId : [[${filmId}]],
            cinemaId : [[${cinemaId}]],
            sceneId : [[${sceneId}]],
            seats : [],
            alreadyChoseSeatIds : [],
            alreadyBuyTicket : [],
        },
        created : function () {
            this.loadCinema();
            this.loadFilm();
            this.loadScene();
            this.listAlreadyBuyTicket();
        },

        methods : {

            confimChose: function() {
                // alert('ok');
                alert(this.alreadyChoseSeatIds)
                // join 方法 通过 ， 分割 成 字符串
                let seatss = this.alreadyChoseSeatIds.join(',')
                // alert(seatss)
                window.open('/toSettlement/' + this.cinemaId + "/" + this.filmId + "/"+ this.sceneId + "?seatInfo="+seatss);
            },

            removeChoseSeat : function(seatId){
                for (var i = 0; i < this.alreadyChoseSeatIds.length;i++){
                    if (seatId == this.alreadyChoseSeatIds[i]) {
                        // 删除已经存在的元素，且只删除当前一个
                        this.alreadyChoseSeatIds.splice(i,1)
                    }
                }
            },

            choseSeatHandler : function(seatId){

                let row = seatId.split("-")[0];
                let col = seatId.split("-")[1];

                for (let i=0; i<this.alreadyBuyTicket.length; i++) {
                    if (this.alreadyBuyTicket[i].seatRow == row && this.alreadyBuyTicket[i].seatCol == col ) {
                        return;
                    }
                }

              // TODO 判断座位是否已被选择
              var seat;
              // != -1 就是包含
              if (this.alreadyChoseSeatIds.indexOf(seatId) != -1){
                    seat = this.getTargetSeat(seatId);
                    seat.imgUrl =  '/images/seat1.png';
                    this.removeChoseSeat(seatId)
                    return;
              }

                seat = this.getTargetSeat(seatId);
                seat.imgUrl =  '/images/seat3.png'
                this.alreadyChoseSeatIds.push(seatId)

            },
            getTargetSeat : function(seatId){
                for (var i =0; i<this.seats.length;i++){
                    if (seatId == this.seats[i].id) {
                        // 得到已经存在的对象
                        return this.seats[i];
                    }
                }
            },

            checkBuyTicket : function(row,col){
                for (let i = 0; i < this.alreadyBuyTicket.length; i++){
                    if (this.alreadyBuyTicket[i].seatRow == row &&  this.alreadyBuyTicket[i].seatCol == col ) {
                        return true;
                    }
                }
                return false;
            },
            createSeats : function(){
                for (var i = 1; i <= 8; i++) {
                    for (var j = 1; j <= 8; j++) {
                        let imgUrlvalue = '/images/seat1.png';
                        if (this.checkBuyTicket(i,j)){
                            imgUrlvalue = '/images/seat2.png';
                        }
                        var seatData = {
                            row : i,
                            col : j,
                            imgUrl : imgUrlvalue,
                            id : i + "-" + j
                        }

                        this.seats.push(seatData)
                    }
                }
            },

            loadFilm : function () {
                var that = this
                axios.get('/film/' + that.filmId)
                    .then(function (response) {
                        that.filmInfo = response.data.data;
                    })
            },
            loadCinema : function () {
                var that = this
                axios.get('/cinema/listCinema/' + this.cinemaId)
                    .then(function (response) {
                        that.cinemaInfo = response.data.data
                    })
            },
            loadScene : function () {
                var that = this
                axios.get("/film/loadScene/" + this.sceneId)
                    .then(function (response) {
                        that.sceneInfo = response.data.data;
                    })
            },
            listAlreadyBuyTicket : function () {
                var that = this
                axios.get("/film/loadAlreadyBuyTicket/" + this.sceneId)
                    .then(function (response) {
                        that.alreadyBuyTicket = response.data.data;
                        that.createSeats();
                    })
            }
        }
    })
</script>

</html>




